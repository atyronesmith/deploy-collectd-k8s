kind: ConfigMap
apiVersion: v1
metadata:
  namespace: collectd
  name: collectd-config

data:

  node-collectd.conf: |-
    # Generated by Puppet

    #Hostname localhost
    #FQDNLookup true

    AutoLoadPlugin false
    #BaseDir "/var/lib/collectd"
    #PluginDir "/usr/lib/collectd"
    TypesDB "/usr/share/collectd/types.db"
    Interval 5
    Timeout 2
    ReadThreads 5
    WriteThreads 5
    #Include "/etc/collectd.d/*.conf"
    # Generated by Puppet 
    <LoadPlugin logfile>  
      Globals false
    </LoadPlugin>

    <Plugin logfile>
      LogLevel info
      File "/var/log/collectd/collectd.log"
      Timestamp true
      PrintSeverity false 
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin amqp1>
      Globals false
      Interval 5
    </LoadPlugin>

    <Plugin amqp1>
      <Transport "metrics">
        Host "192.168.10.50"
        Port "5672"
        User "guest"
        Password "guest"  
        Address "collectd"
        RetryDelay 1
        <Instance "notify">
          Format "JSON"   
          Notify true
          PreSettle true  
        </Instance>
        <Instance "telemetry">
          Format "JSON"   
          PreSettle false 
        </Instance>
      </Transport>
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin cpu>
      Globals false
      Interval 5
    </LoadPlugin>

    <Plugin cpu>
      ReportByState true  
      ReportByCpu true
      ValuesPercentage true
      ReportNumCpu false  
      ReportGuestState false
      SubtractGuestState true
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin df>
      Globals false
      Interval 300
    </LoadPlugin>

    <Plugin df>
      FSType "xfs"
      IgnoreSelected true 
      ReportByDevice false
      ReportInodes true   
      ValuesAbsolute true 
      ValuesPercentage false
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin disk>
      Globals false
      Interval 5
    </LoadPlugin>

    <Plugin disk>
      IgnoreSelected false
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin hugepages>
      Globals false
      Interval 60
    </LoadPlugin>

    <Plugin "hugepages">  
      ReportPerNodeHP true
      ReportRootHP true   
      ValuesPages true
      ValuesBytes false   
      ValuesPercentage false
    </Plugin>

    # Generated by Puppet 
    #<LoadPlugin intel_rdt>
    #  Globals false
    #  Interval 5
    #</LoadPlugin>

    #<Plugin "intel_rdt">  
    #  Cores ""
    #</Plugin>

    # Generated by Puppet 
    <LoadPlugin interface>
      Globals false
      Interval 5
    </LoadPlugin>

    <Plugin interface>
      IgnoreSelected false
      ReportInactive true 
    </Plugin>

    # Generated by Puppet 
    #<LoadPlugin ipmi>
    #  Globals false
    #  Interval 60
    #</LoadPlugin>

    # <Plugin "ipmi">
    #   IgnoreSelected false
    #   NotifySensorAdd false
    #   NotifySensorRemove true
    #   NotifySensorNotPresent false
    # </Plugin>

    # Generated by Puppet 
    <LoadPlugin load>
      Globals false
      Interval 60
    </LoadPlugin>

    <Plugin load>
      ReportRelative false
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin memory>   
      Globals false
      Interval 5
    </LoadPlugin>

    <Plugin memory>
      ValuesAbsolute true 
      ValuesPercentage false
    </Plugin>

    <LoadPlugin chrony>
    </LoadPlugin>

    <Plugin chrony>  
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin ovs_events>
       Globals false
    </LoadPlugin>

    <Plugin "ovs_events">
     SendNotification false
     Socket "/var/run/openvswitch/db.sock" 
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin ovs_stats>
      Globals false
    </LoadPlugin>

    <Plugin "ovs_stats">  
      Socket "/var/run/openvswitch/db.sock"
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin processes>
      Globals false
      Interval 5
    </LoadPlugin>
   
    <Plugin processes>
      CollectFileDescriptor true
      CollectContextSwitch true
      ProcessMatch "kubenetes" "^kube*"
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin unixsock> 
      Globals false
    </LoadPlugin>

    <Plugin unixsock>
      SocketFile  "/var/run/collectd-socket"
      SocketGroup "root"  
      SocketPerms "0770"  
      DeleteSocket "true" 
    </Plugin>

    # Generated by Puppet 
    <LoadPlugin uptime>   
      Globals false
      Interval 60
    </LoadPlugin>


    # Generated by Puppet 
    # <LoadPlugin virt>
    #   Globals false
    #   Interval 5
    # </LoadPlugin>

    # <Plugin virt>
    #   Connection "qemu:///system"
    #   HostnameFormat "hostname uuid"
    #   ExtraStats "cpu_util disk disk_err pcpu job_stats_background perf vcpupin"
    # </Plugin>

    #Last line (collectd requires ‘\n’ at the last line)
